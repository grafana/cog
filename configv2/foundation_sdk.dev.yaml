# yaml-language-server: $schema=https://raw.githubusercontent.com/grafana/cog/main/schemas/pipeline.json

debug: true

parameters:
  output_dir: './generated/%l'
  kind_registry_path: '../kind-registry'
  kind_registry_version: 'v12.0.x'
  grafana_version: 'main'
  go_package_root: 'github.com/grafana/cog/generated/go'
  php_namespace_root: 'Grafana\Foundation'
  java_package_path: 'com.grafana.foundation'

inputs:
  - if: '"%grafana_version%" == "main" || semver("%grafana_version%").MoreThanEqual(semver("v12.0.x"))'
    cue:
      entrypoint: '%__config_dir%/../schemas/core/dashboard'
      metadata:
        kind: core
      transformations:
        - '%__config_dir%/compiler/dashboard.yaml'

  - kind_registry:
      path: '%kind_registry_path%'
      version: '%kind_registry_version%'
      transformations:
        - '%__config_dir%/compiler/kind_registry.yaml'

transformations:
  schemas:
    - '%__config_dir%/compiler/common_passes.yaml'

  builders:
    - '%__config_dir%/veneers'

output:
  directory: '%output_dir%'

  types: true
  builders: true
  converters: false # TODO
  api_reference: false # TODO

  languages:
    - go:
        package_root: '%go_package_root%'
        #builder_templates:
        #  - '%__config_dir%/templates/go'
        generate_strict_unmarshaller: true
        generate_equal: true
        generate_validate: true
    - jsonschema: {}
    - openapi: {}
    - php:
        namespace_root: '%php_namespace_root%'
        #builder_templates:
        #  - '%__config_dir%/templates/php'
    - python:
        path_prefix: grafana_foundation_sdk
        #builder_templates:
        #  - '%__config_dir%/templates/python'
    - typescript: {}
        #builder_templates:
        #  - '%__config_dir%/templates/typescript'
    - java:
        package_path: '%java_package_path%'
        #builder_templates:
        #  - '%__config_dir%/templates/java'
