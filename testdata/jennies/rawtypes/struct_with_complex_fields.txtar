# Basic struct with scalar fields, all required.
-- ir.json --
{
    "Package": "struct_complex_fields",
    "Definitions": [
        {
            "Name": "SomeStruct",
            "Comments": ["This struct does things."],
            "Type": {
                "Kind": "struct",
                "Struct": {
                    "Fields": [
                        {
                            "Name": "FieldRef",
                            "Required": true,
                            "Type": {
                                "Kind": "ref",
                                "Ref": {"ReferredPkg": "struct_complex_fields", "ReferredType": "SomeOtherStruct"}
                            }
                        },
                        {
                            "Name": "FieldDisjunctionOfScalars",
                            "Required": true,
                            "Type": {
                                "Kind": "disjunction",
                                "Disjunction": {
                                    "Branches": [
                                        {
                                            "Kind": "scalar",
                                            "Scalar": {"ScalarKind": "string"}
                                        },
                                        {
                                            "Kind": "scalar",
                                            "Scalar": {"ScalarKind": "bool"}
                                        }
                                    ]
                                }
                            }
                        },
                        {
                            "Name": "FieldMixedDisjunction",
                            "Required": true,
                            "Type": {
                                "Kind": "disjunction",
                                "Disjunction": {
                                    "Branches": [
                                        {
                                            "Kind": "scalar",
                                            "Scalar": {"ScalarKind": "string"}
                                        },
                                        {
                                            "Kind": "ref",
                                            "Ref": {"ReferredPkg": "struct_complex_fields", "ReferredType": "SomeOtherStruct"}
                                        }
                                    ]
                                }
                            }
                        },
                        {
                            "Name": "FieldDisjunctionWithNull",
                            "Required": true,
                            "Type": {
                                "Kind": "disjunction",
                                "Disjunction": {
                                    "Branches": [
                                        {
                                            "Kind": "scalar",
                                            "Scalar": {"ScalarKind": "string"}
                                        },
                                        {
                                            "Kind": "scalar",
                                            "Scalar": {"ScalarKind": "null"}
                                        }
                                    ]
                                }
                            }
                        },
                        {
                            "Name": "FieldAnonymousEnum",
                            "Required": true,
                            "Type": {
                                "Kind": "enum",
                                "Enum": {
                                    "Values": [
                                        {
                                            "Name": "GreaterThan",
                                            "Type": {
                                                "Kind": "scalar",
                                                "Scalar": {"ScalarKind": "string"}
                                            },
                                            "Value": ">"
                                        },
                                        {
                                            "Name": "LessThan",
                                            "Type": {
                                                "Kind": "scalar",
                                                "Scalar": {"ScalarKind": "string"}
                                            },
                                            "Value": "<"
                                        }
                                    ]
                                }
                            }
                        },
                        {
                            "Name": "FieldArrayOfStrings",
                            "Required": true,
                            "Type": {
                                "Kind": "array",
                                "Array": {
                                    "ValueType": {
                                        "Kind": "scalar",
                                        "Scalar": {"ScalarKind": "string"}
                                    }
                                }
                            }
                        },
                        {
                            "Name": "FieldMapOfStringToString",
                            "Required": true,
                            "Type": {
                                "Kind": "map",
                                "Map": {
                                    "IndexType": {
                                        "Kind": "scalar",
                                        "Scalar": {"ScalarKind": "string"}
                                    },
                                    "ValueType": {
                                        "Kind": "scalar",
                                        "Scalar": {"ScalarKind": "string"}
                                    }
                                }
                            }
                        },
                        {
                            "Name": "FieldAnonymousStruct",
                            "Required": true,
                            "Type": {
                                "Kind": "struct",
                                "Struct": {
                                    "Fields": [
                                        {
                                            "Name": "FieldAny",
                                            "Required": true,
                                            "Type": {
                                                "Kind": "scalar",
                                                "Scalar": {"ScalarKind": "any"}
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    ]
                }
            }
        },

        {
            "Name": "SomeOtherStruct",
            "Type": {
                "Kind": "struct",
                "Struct": {
                    "Fields": [
                        {
                            "Name": "FieldAny",
                            "Required": true,
                            "Type": {
                                "Kind": "scalar",
                                "Scalar": {"ScalarKind": "any"}
                            }
                        }
                    ]
                }
            }
        }
    ]
}
-- out/jennies/TypescriptRawTypes --
== types/struct_complex_fields/types_gen.ts
// This struct does things.
export interface SomeStruct {
	FieldRef: SomeOtherStruct;
	FieldDisjunctionOfScalars: string | boolean;
	FieldMixedDisjunction: string | SomeOtherStruct;
	FieldDisjunctionWithNull: string | null;
	FieldAnonymousEnum: ">" | "<";
	FieldArrayOfStrings: string[];
	FieldMapOfStringToString: Record<string, string>;
	FieldAnonymousStruct: {
		FieldAny: any;
	};
}

export const defaultSomeStruct: Partial<SomeStruct> = {
};

export interface SomeOtherStruct {
	FieldAny: any;
}

export const defaultSomeOtherStruct: Partial<SomeOtherStruct> = {
};

-- out/jennies/GoRawTypes --
== types/struct_complex_fields/types_gen.go
package types

// This struct does things.
type SomeStruct struct {
	FieldRef SomeOtherStruct `json:"FieldRef"`
	FieldDisjunctionOfScalars StringOrBool `json:"FieldDisjunctionOfScalars"`
	FieldMixedDisjunction StringOrSomeOtherStruct `json:"FieldMixedDisjunction"`
	FieldDisjunctionWithNull *string `json:"FieldDisjunctionWithNull"`
	FieldAnonymousEnum FieldAnonymousEnumEnum `json:"FieldAnonymousEnum"`
	FieldArrayOfStrings []string `json:"FieldArrayOfStrings"`
	FieldMapOfStringToString map[string]string `json:"FieldMapOfStringToString"`
	FieldAnonymousStruct struct {
	FieldAny any `json:"FieldAny"`
} `json:"FieldAnonymousStruct"`
}

type SomeOtherStruct struct {
	FieldAny any `json:"FieldAny"`
}

type FieldAnonymousEnumEnum string
const (
	FieldAnonymousEnumEnumFieldAnonymousEnumGreaterThan FieldAnonymousEnumEnum = ">"
	FieldAnonymousEnumEnumFieldAnonymousEnumLessThan FieldAnonymousEnumEnum = "<"
)


type StringOrBool struct {
	ValString *string `json:"ValString,omitempty"`
	ValBool *bool `json:"ValBool,omitempty"`
}

func (resource *StringOrBool) MarshalJSON() ([]byte, error) {

	if resource.ValString != nil {
		return json.Marshal(resource.ValString)
	}

	if resource.ValBool != nil {
		return json.Marshal(resource.ValBool)
	}


	return nil, nil
}

func (resource *StringOrBool) UnmarshalJSON(raw []byte) error {
	if raw == nil {
		return nil
	}

	var errList []error

	// ValString
	var ValString string
	if err := json.Unmarshal(raw, &ValString); err != nil {
		errList = append(errList, err)
		resource.ValString = nil
	} else {
		resource.ValString = &ValString
		return nil
	}

	// ValBool
	var ValBool bool
	if err := json.Unmarshal(raw, &ValBool); err != nil {
		errList = append(errList, err)
		resource.ValBool = nil
	} else {
		resource.ValBool = &ValBool
		return nil
	}

	return errors.Join(errList...)
}

type StringOrSomeOtherStruct struct {
	ValString *string `json:"ValString,omitempty"`
	ValSomeOtherStruct *SomeOtherStruct `json:"ValSomeOtherStruct,omitempty"`
}

